define(["jquery","core/ajax"],function(g,f){return progress={vimeo:function(e,r,t,n){progress._internal_view_id=e;var i=document.getElementById(n);var a=new Vimeo.Player(i);if(r){a.setCurrentTime(r)}document.addEventListener("setCurrentTime",function(e){a.setCurrentTime(e.detail.goCurrentTime)});a.on("ended",function(){});Promise.all([a.getVideoWidth(),a.getVideoHeight()]).then(function(e){var r=e[0];var t=e[1];console.log([r,t]);progress._internal_resize(r,t)});var s=0;setInterval(function(){if(s>1){a.getCurrentTime().then(function(e){e=parseInt(e);progress._internal_saveprogress(a.setCurrentTime,e,s)})}else{a.getDuration().then(function(e){s=e})}},300)},youtube:function(e,r,t,n,i,a,s,o,_){progress._internal_view_id=e;var l=new YT.Player(t,{suggestedQuality:"large",videoId:n,width:"100%",playerVars:{showrel:a,showcontrols:s,showshowinfo:o,autoplay:_},events:{onReady:function(e){if(i==1){progress._internal_resize(16,9)}else{progress._internal_resize(4,3)}if(r){l.seekTo(r)}document.addEventListener("setCurrentTime",function(e){l.seekTo(e.detail.goCurrentTime)})},onStateChange:function(e){}}});setInterval(function(){if(l&&l.getCurrentTime!=undefined){var e=parseInt(l.getCurrentTime());progress._internal_saveprogress(l.seekTo,e,l.getDuration())}},150)},drive:function(e,r,t){progress._internal_view_id=e;progress._internal_saveprogress(1,1);if(t==6){progress._internal_resize(4,3)}else if(t==7){progress._internal_resize(16,9)}else{progress._internal_resize(480,640)}},_internal_resize:function(t,n){g(window).resize(e);e();function e(){var e=g("#supervideo_area_embed").width();var r=e*n/t;g("#supervideo_area_embed iframe").css({width:e,height:r})}},_internal_last_currenttime:-1,_internal_last_percent:-1,_internal_assistido:[],_internal_view_id:0,_internal_saveprogress:function(e,r,t){if(!t){return 0}if(progress._internal_last_currenttime==r){return}progress._internal_last_currenttime=r;if(progress._internal_assistido.length==0){var n=g("#mapa-visualizacao");var i=[];try{var a=n.attr("data-mapa");if(a){i=JSON.parse(atob(a))}}catch(e){i=[]}for(var s=0;s<100;s++){if(typeof i[s]!="undefined"){progress._internal_assistido[s]=i[s]}else{progress._internal_assistido[s]=0}var o=Math.floor(t/100*s);var _=Math.floor(o/3600);var l=Math.floor(o/60)%60;var u=o%60;var d=g("<div id='mapa-visualizacao-"+s+"'>");if(_)d.attr("title","ir para "+_+":"+l+":"+u);else d.attr("title","ir para "+l+":"+u);d.attr("data-currenttime",o);d.click(function(){var e=g(this).attr("data-currenttime");var r=document.createEvent("CustomEvent");r.initCustomEvent("setCurrentTime",true,true,{goCurrentTime:parseInt(e)});document.dispatchEvent(r)});n.append(d)}}var p=0;if(r!=0){var v=parseInt(r/t*100);progress._internal_assistido[v]=1;for(var c=0;c<100;c++){if(progress._internal_assistido[c]){p++;g("#mapa-visualizacao-"+c).css({opacity:1})}}}if(progress._internal_last_percent==p){return}progress._internal_last_percent=p;f.call([{methodname:"mod_supervideo_services_save_progress",args:{view_id:progress._internal_view_id,currenttime:parseInt(r),duration:parseInt(t),percent:parseInt(p),mapa:JSON.stringify(progress._internal_assistido)}}]);if(p>=0){g("#sua-view span").html(p+"%")}},_internal_add:function(e,r){return e+r}}});