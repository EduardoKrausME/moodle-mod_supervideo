define(["jquery","core/ajax"],function(v,g){return progress={youtube:function(e,r,t,n,i,s,a,o,l){progress._internal_view_id=e;var u=new YT.Player(t,{suggestedQuality:"large",videoId:n,width:"100%",playerVars:{showrel:s,showcontrols:a,showshowinfo:o,autoplay:l},events:{onReady:function(e){if(i==1){progress._internal_resize(16,9)}else{progress._internal_resize(4,3)}if(r){u.seekTo(r)}document.addEventListener("setCurrentTime",function(e){u.seekTo(e.detail.goCurrentTime)})},onStateChange:function(e){}}});setInterval(function(){if(u&&u.getCurrentTime!=undefined){var e=parseInt(u.getCurrentTime());progress._internal_saveprogress(e,u.getDuration())}},150)},resource_audio:function(e,r,t,n){progress._internal_view_id=e;var i={controls:["play","progress","current-time","mute","volume","pip","airplay","duration"],tooltips:{controls:true,seek:true},settings:["speed","loop"],autoplay:n,storage:{enabled:true,key:"id-"+e},speed:{selected:1,options:[.5,.75,1,1.25,1.5,1.75,2,4]}};var s=new Plyr("#"+t,i);window.player=s;if(r){s.currentTime=r}document.addEventListener("setCurrentTime",function(e){s.currentTime=e.detail.goCurrentTime});setInterval(function(){progress._internal_saveprogress(s.currentTime,s.duration)},200)},resource_video:function(e,r,t,n,i){progress._internal_view_id=e;var s={controls:["play-large","play","current-time","progress","duration","mute","volume","settings","pip","airplay","fullscreen"],tooltips:{controls:true,seek:true},settings:["speed","loop"],autoplay:i,storage:{enabled:true,key:"id-"+e},speed:{selected:1,options:[.5,.75,1,1.25,1.5,1.75,2,4]}};var a=new Plyr("#"+t,s);window.player=a;if(r){a.currentTime=r}document.addEventListener("setCurrentTime",function(e){a.currentTime=e.detail.goCurrentTime});setInterval(function(){progress._internal_saveprogress(a.currentTime,a.duration)},200)},vimeo:function(e,r,t,n){progress._internal_view_id=e;var i=document.getElementById(n);var s=new Vimeo.Player(i);if(r){s.setCurrentTime(r)}document.addEventListener("setCurrentTime",function(e){s.setCurrentTime(e.detail.goCurrentTime)});s.on("ended",function(){});Promise.all([s.getVideoWidth(),s.getVideoHeight()]).then(function(e){var r=e[0];var t=e[1];console.log([r,t]);progress._internal_resize(r,t)});var a=0;setInterval(function(){if(a>1){s.getCurrentTime().then(function(e){e=parseInt(e);progress._internal_saveprogress(e,a)})}else{s.getDuration().then(function(e){a=e})}},300)},drive:function(e,r,t){progress._internal_view_id=e;progress._internal_saveprogress(1,1);if(t==6){progress._internal_resize(4,3)}else if(t==7){progress._internal_resize(16,9)}else{progress._internal_resize(480,640)}},_internal_resize:function(t,n){v(window).resize(e);e();function e(){var e=v("#supervideo_area_embed").width();var r=e*n/t;v("#supervideo_area_embed iframe").css({width:e,height:r})}},_internal_last_currenttime:-1,_internal_last_percent:-1,_internal_assistido:[],_internal_view_id:0,_internal_saveprogress:function(e,r){if(!r){return 0}if(progress._internal_last_currenttime==e){return}progress._internal_last_currenttime=e;if(progress._internal_assistido.length==0){var t=v("#mapa-visualizacao");var n=[];try{var i=t.attr("data-mapa");if(i){n=JSON.parse(atob(i))}}catch(e){n=[]}for(var s=0;s<100;s++){if(typeof n[s]!="undefined"){progress._internal_assistido[s]=n[s]}else{progress._internal_assistido[s]=0}var a=Math.floor(r/100*s);var o=Math.floor(a/3600);var l=Math.floor(a/60)%60;var u=a%60;var _=v("<div id='mapa-visualizacao-"+s+"'>");if(o)_.attr("title","ir para "+o+":"+l+":"+u);else _.attr("title","ir para "+l+":"+u);_.attr("data-currenttime",a);_.click(function(){var e=v(this).attr("data-currenttime");var r=document.createEvent("CustomEvent");r.initCustomEvent("setCurrentTime",true,true,{goCurrentTime:parseInt(e)});document.dispatchEvent(r)});t.append(_)}}var p=0;if(e!=0){var d=parseInt(e/r*100);progress._internal_assistido[d]=1;for(var c=0;c<100;c++){if(progress._internal_assistido[c]){p++;v("#mapa-visualizacao-"+c).css({opacity:1})}}}if(progress._internal_last_percent==p){return}progress._internal_last_percent=p;g.call([{methodname:"mod_supervideo_services_save_progress",args:{view_id:progress._internal_view_id,currenttime:parseInt(e),duration:parseInt(r),percent:parseInt(p),mapa:JSON.stringify(progress._internal_assistido)}}]);if(p>=0){v("#sua-view span").html(p+"%")}},_internal_add:function(e,r){return e+r}}});